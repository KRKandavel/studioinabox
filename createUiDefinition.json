{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {
                "name": "providersApi",
                "type": "Microsoft.Solutions.ArmApiControl",
                "request": {
                    "method": "GET",
                    "path": "[concat(subscription().id, '/providers/Microsoft.Network?api-version=2021-04-01')]"
                }
            },
            {
                "name": "environment",
                "type": "Microsoft.Common.TextBox",
                "label": "Environment",
                "defaultValue": "prod",
                "toolTip": "Provide an environment name that will be used in resource names and tagging. Min 3, max 20",
                "constraints": {
                    "required": true,
                    "regex": "^[0-9a-zA-Z][0-9a-zA-Z\\-]{0,4}$",
                    "validationMessage": "Environment must start with an alphanumeric character and can contain alphanumeric or hyphen characters, up to 5 characters in length"
                }
            },
            {
                "name": "primaryZone",
                "type": "Microsoft.Common.DropDown",
                "label": "Region / Zone (Primary)",
                "defaultValue": "No redundancy",
                "toolTip": "Select Region or Zone to deploy primary site.",
                "constraints": {
                    "allowedValues": "[map(parse(replace(concat('[{\"label\":\"No redundancy\",\"value\":\"region\"},',skip(string(map(first(map(filter(first(map(filter(basics('providersApi').resourceTypes,(entry)=>equals(toLower(entry.resourceType),'publicipaddresses')),(item)=>item.zoneMappings)),(item)=>equals(replace(toLower(item.location),' ',''),coalesce(location(),''))),(item)=>item.zones)),(item)=>parse(concat('{\"label\":\"', item,'\",\"value\":\"', item,'\"}' )))),1)), ',]',']')),(item)=>parse(concat('{\"label\":\"', item.label, '\",\"value\":\"', item.value, '\"}')))]",
                    "required": true
                },
                "visible": true
            },
            {
                "name": "secondaryZone",
                "type": "Microsoft.Common.DropDown",
                "label": "Availability zone (Secondary)",
                "defaultValue": "2",
                "toolTip": "{{tooltipavalibilityzone}}",
                "constraints": {
                    "allowedValues": "[map(parse(replace(concat('[',skip(string(map(first(map(filter(first(map(filter(basics('providersApi').resourceTypes,(entry)=>equals(toLower(entry.resourceType),'publicipaddresses')),(item)=>item.zoneMappings)),(item)=>equals(replace(toLower(item.location),' ',''),coalesce(location(),''))),(item)=>item.zones)),(item)=>parse(concat('{\"label\":\"', item,'\",\"value\":\"', item,'\"}' )))),1)), ',]',']')),(item)=>parse(concat('{\"label\":\"', item.label, '\",\"value\":\"', item.value, '\"}')))]",
                    "required": false
                },
                "visible": "[and(not(equals(basics('primaryZone'),'region')),not(empty(filter(first(map(filter(basics('providersApi').resourceTypes,(entry)=>equals(toLower(entry.resourceType),'publicipaddresses')),(item)=>item.zoneMappings)),(item)=>equals(replace(toLower(item.location),' ',''),coalesce(location(),''))))))]"
            }
        ],
        "steps": [
            {
                "name": "VirtualNetworkConfig",
                "label": "Virtual Network Configuration",
                "subLabel": {
                    "preValidation": "Configure the virtual network's resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Virtual Machine Settings",
                "elements": [
                    {
                        "name": "virtualNetwork",
                        "type": "Microsoft.Network.VirtualNetworkCombo",
                        "label": {
                            "virtualNetwork": "Virtual network",
                            "subnets": "Subnets"
                        },
                        "toolTip": {
                            "virtualNetwork": "Name of the virtual network",
                            "subnets": "Subnets for the virtual network"
                        },
                        "defaultValue": {
                            "name": "HXVNET",
                            "addressPrefixSize": "/16"
                        },
                        "constraints": {
                            "minAddressPrefixSize": "/16"
                        },
                        "subnets": {
                            "subnet1": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "PublicSubnet0",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": false
                                }
                            },
                            "subnet2": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "PublicSubnet1",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": false
                                }
                            },
                            "subnet3": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "PrivateSubnet0",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": false
                                }
                            },
                            "subnet4": {
                                "label": "Subnet",
                                "defaultValue": {
                                    "name": "PrivateSubnet1",
                                    "addressPrefixSize": "/24"
                                },
                                "constraints": {
                                    "minAddressPrefixSize": "/24",
                                    "minAddressCount": 12,
                                    "requireContiguousAddresses": false
                                }
                            }
                        }
                    },
                    {
                        "name": "ipRangeToPermitFrom",
                        "type": "Microsoft.Common.TextBox",
                        "label": "IP range to Permit from",
                        "defaultValue": "1.1.1.1/32",
                        "toolTip": "Input your public IP address in CIDR notation. Example: 162.244.43.80/32. Use a service like whatismyipaddress.com to find your public IP address.",
                        "constraints": {
                            "required": true,
                            "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\/(\\d|[1-2]\\d|3[0-2])$",
                            "validationMessage": "IP range must be a valid CIDR range of the form x.x.x.x/x"
                        }
                    }
                ]
            },
            {
                "name": "PerforceServerConfig",
                "label": "Perforce Server Configuration",
                "subLabel": {
                    "preValidation": "Configure the Perforce Server's resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Perforce Server Configuration",
                "elements": [
                    {
                        "name": "p4VMSize",
                        "type": "Microsoft.Compute.SizeSelector",
                        "label": "P4 instance type",
                        "toolTip": "Select P4 server VM SKU",
                        "recommendedSizes": [
                            "Standard_D2_v2",
                            "Standard_D2_v4",
                            "Standard_D4_v4",
                            "Standard_D8_v4",
                            "Standard_E2_v4",
                            "Standard_E4_v4",
                            "Standard_E8_v4"
                        ],
                        "constraints": {
                            "allowedSizes": [
                                "Standard_D2_v2",
                                "Standard_D2_v3",
                                "Standard_D2a_v4",
                                "Standard_D2d_v4",
                                "Standard_D2_v4",
                                "Standard_D4_v4",
                                "Standard_D8_v4",
                                "Standard_D4_v3",
                                "Standard_D8_v3",
                                "Standard_D4a_v4",
                                "Standard_D8a_v4",
                                "Standard_D4d_v4",
                                "Standard_D8d_v4",
                                "Standard_F2s_v2",
                                "Standard_F4s_v2",
                                "Standard_F8s_v2",
                                "Standard_E2_v3",
                                "Standard_E4_v3",
                                "Standard_E8_v3",
                                "Standard_E2_v4",
                                "Standard_E4_v4",
                                "Standard_E8_v4",
                                "Standard_E2_v3",
                                "Standard_E4_v3",
                                "Standard_E8_v3"
                            ]
                        },
                        "osPlatform": "Linux",
                        "count": "1",
                        "visible": true
                    },
                    {
                        "name": "p4PrivateAddress",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Private IP Address of P4 (Optional)",
                        "defaultValue": "",
                        "toolTip": "Input your public IP address in CIDR notation. Example: 10.130.0.100. Use a service like whatismyipaddress.com to find your public IP address.",
                        "constraints": {
                            "required": false,
                            "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)$",
                            "validationMessage": "IP range must be a valid CIDR range of the form x.x.x.x"
                        }
                    },
                    {
                        "name": "linuxCredential",
                        "type": "Microsoft.Common.Section",
                        "label": "Linux Account Details",
                        "elements": [
                            {
                                "name": "p4SSHSource",
                                "type": "Microsoft.Common.DropDown",
                                "label": "SSH public key source",
                                "defaultValue": "Use existing key stored in Azure",
                                "toolTip": "Specify the SSH key source for P4 server.",
                                "constraints": {
                                    "allowedValues": [
                                        {
                                            "label": "Use existing key stored in Azure",
                                            "value": "existing"
                                        },
                                        {
                                            "label": "Use existig public key",
                                            "value": "public"
                                        }
                                    ],
                                    "validations": [
                                        {
                                            "isValid": "[not(empty(steps('PerforceServerConfig').linuxCredential.adminExistKey.name))]",
                                            "message": "You need to select a key to proceed"
                                        }
                                    ],
                                    "required": true
                                },
                                "visible": true
                            },
                            {
                                "name": "adminUsername",
                                "type": "Microsoft.Compute.UserNameTextBox",
                                "label": "User name",
                                "defaultValue": "centos",
                                "toolTip": "Specify a user for accessing the virtual machines within your cluster. Must be a valid Ubuntu username",
                                "constraints": {
                                    "required": true,
                                    "regex": "^(?!(?:adm|admin|audio|backup|bin|cdrom|crontab|daemon|dialout|dip|disk|fax|floppy|fuse|games|gnats|irc|kmem|landscape|libuuid|list|lp|mail|man|messagebus|mlocate|netdev|news|nobody|nogroup|operator|plugdev|proxy|root|sasl|shadow|src|ssh|sshd|staff|sudo|sync|sys|syslog|tape|tty|users|utmp|uucp|video|voice|whoopsie|www\\-data)$)\\w+$",
                                    "validationMessage": "Username must not be a reserved Ubuntu username"
                                },
                                "visible": false,
                                "osPlatform": "Linux"
                            },                            
                            {
                                "name": "adminExistKey",
                                "type": "Microsoft.Solutions.ResourceSelector",
                                "label": "Stored Keys",
                                "resourceType": "Microsoft.Compute/sshPublicKeys",
                                "toolTip": "Select new key pair stored in Azure",
                                "options": {
                                    "filter": {
                                        "subscription": "onBasics",
                                        "location": "onBasics"
                                    }
                                },
                                "constraints":{
                                    "required": true,
                                    "regex": "/(?!^$)([^\\s])/",
                                    "validationMessage": "You must select existing key to proceed."
                                },
                                "visible": "[equals(steps('PerforceServerConfig').linuxCredential.p4SSHSource, 'existing')]"
                            },
                            {
                                "name": "adminPublicKey",
                                "type": "Microsoft.Compute.CredentialsCombo",
                                "label": {
                                    "authenticationType": "Authentication type",
                                    "password": "Password",
                                    "confirmPassword": "Confirm password",
                                    "sshPublicKey": "SSH public key for built-in user 'centos'"
                                },
                                "toolTip": {
                                    "authenticationType": "Choose Authentication type Password or PublicKey(SSH).",
                                    "password": "Enter the password for the specified user name.",
                                    "sshPublicKey": "Copy Public key into field."
                                },
                                "options": {
                                    "hidePassword": true,
                                    "hideConfirmation": true
                                },
                                "constraints": {
                                    "required": true,
                                    "customValidationMessage": "The value must not be empty."
                                },
                                "osPlatform": "Linux",
                                "visible": "[equals(steps('PerforceServerConfig').linuxCredential.p4SSHSource, 'public')]"
                            }
                        ]
                    },
                    {
                        "name": "p4FromScratchOrSnapshot",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy from Scratch/Snapshot",
                        "defaultValue": "Scratch",
                        "toolTip": "Select deploy option of scratch or snapshot",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Scratch",
                                    "value": "scratch"
                                },
                                {
                                    "label": "Snapshot",
                                    "value": "snapshot"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "p4SnapshotIDArchive",
                        "type": "Microsoft.Solutions.ResourceSelector",
                        "label": "Snapshot for Archive",
                        "resourceType": "Microsoft.Compute/snapshots",
                        "options": {
                            "filter": {
                                "subscription": "onBasics",
                                "location": "onBasics"
                            }
                        },
                        "constraints": {
                            "required": true,
                            "regex": "/(?!^$)([^\\s])/",
                            "validationMessage": "You must select existing snapshot to proceed."

                        },
                        "visible": "[equals(steps('PerforceServerConfig').p4FromScratchOrSnapshot, 'snapshot')]"
                    },
                    {
                        "name": "p4SnapshotIDJournal",
                        "type": "Microsoft.Solutions.ResourceSelector",
                        "label": "Snapshot for Journal",
                        "resourceType": "Microsoft.Compute/snapshots",
                        "options": {
                            "filter": {
                                "subscription": "onBasics",
                                "location": "onBasics"
                            }
                        },
                        "constraints": {
                            "required": true,
                            "regex": "/(?!^$)([^\\s])/",
                            "validationMessage": "You must select existing snapshot to proceed."
                        },
                        "visible": "[equals(steps('PerforceServerConfig').p4FromScratchOrSnapshot, 'snapshot')]"
                    },
                    {
                        "name": "p4SnapshotIDLog",
                        "type": "Microsoft.Solutions.ResourceSelector",
                        "label": "Snapshot for Log",
                        "resourceType": "Microsoft.Compute/snapshots",
                        "options": {
                            "filter": {
                                "subscription": "onBasics",
                                "location": "onBasics"
                            }
                        },
                        "constraints": {
                            "required": true,
                            "regex": "/(?!^$)([^\\s])/",
                            "validationMessage": "You must select existing snapshot to proceed."
                        },
                        "visible": "[equals(steps('PerforceServerConfig').p4FromScratchOrSnapshot, 'snapshot')]"
                    },
                    {
                        "name": "p4SnapshotIDMetadata",
                        "type": "Microsoft.Solutions.ResourceSelector",
                        "label": "Snapshot for Metadata",
                        "resourceType": "Microsoft.Compute/snapshots",
                        "options": {
                            "filter": {
                                "subscription": "onBasics",
                                "location": "onBasics"
                            }
                        },
                        "constraints": {
                            "required": true,
                            "regex": "/(?!^$)([^\\s])/",
                            "validationMessage": "You must select existing snapshot to proceed."
                        },
                        "visible": "[equals(steps('PerforceServerConfig').p4FromScratchOrSnapshot, 'snapshot')]"
                    },
                    {
                        "name": "depotDiskType",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Disk type for Depot",
                        "defaultValue": "Standard SSD",
                        "toolTip": "Select disk type for Depot.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Standard HDD",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Standard SSD",
                                    "value": "StandardSSD_LRS"
                                },
                                {
                                    "label": "Premium SSD",
                                    "value": "Premium_LRS"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "depotDiskSize",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Disk size for Depot",
                        "defaultValue": "512",
                        "toolTip": "The size (GB) of the Managed disk attached to Depot.",
                        "constraints": {
                            "required": true,
                            "regex": "^\\d+$",
                            "validationMessage": "Value must be numeric and greater than or equal to 0"
                        },
                        "visible": true
                    },
                    {
                        "name": "logDiskType",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Disk type for Log",
                        "defaultValue": "Standard SSD",
                        "toolTip": "Select disk type for Log.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Standard HDD",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Standard SSD",
                                    "value": "StandardSSD_LRS"
                                },
                                {
                                    "label": "Premium SSD",
                                    "value": "Premium_LRS"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "logDiskSize",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Disk size for Log",
                        "defaultValue": "50",
                        "toolTip": "The size (GB) of the Managed disk attached to Log.",
                        "constraints": {
                            "required": true,
                            "regex": "^\\d+$",
                            "validationMessage": "Value must be numeric and greater than or equal to 0"
                        },
                        "visible": true
                    },
                    {
                        "name": "metadataDiskType",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Disk type for Metadata",
                        "defaultValue": "Standard SSD",
                        "toolTip": "Select disk type for Metadata.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Standard HDD",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Standard SSD",
                                    "value": "StandardSSD_LRS"
                                },
                                {
                                    "label": "Premium SSD",
                                    "value": "Premium_LRS"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "metadataDiskSize",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Disk size for Metadata",
                        "defaultValue": "64",
                        "toolTip": "The size (GB) of the Managed disk attached to Metadata.",
                        "constraints": {
                            "required": true,
                            "regex": "^\\d+$",
                            "validationMessage": "Value must be numeric and greater than or equal to 0"
                        },
                        "visible": true
                    },
                    {
                        "name": "journalDiskType",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Disk type for Journal",
                        "defaultValue": "Standard SSD",
                        "toolTip": "Select disk type for Journal.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Standard HDD",
                                    "value": "Standard_LRS"
                                },
                                {
                                    "label": "Standard SSD",
                                    "value": "StandardSSD_LRS"
                                },
                                {
                                    "label": "Premium SSD",
                                    "value": "Premium_LRS"
                                }
                            ],
                            "required": true
                        },
                        "visible": true
                    },
                    {
                        "name": "journalDiskSize",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Disk size for Journal",
                        "defaultValue": "64",
                        "toolTip": "The size (GB) of the Managed disk attached for Log.",
                        "constraints": {
                            "required": true,
                            "regex": "^\\d+$",
                            "validationMessage": "Value must be numeric and greater than or equal to 0"
                        },
                        "visible": true
                    },
                    {
                        "name": "p4PreUserData",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Pre Userdata",
                        "defaultValue": "",
                        "toolTip": "Userdata to run before the default P4 userdata.",
                        "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                        "multiLine": true,
                        "constraints": {
                            "required": false,
                            "validations": [
                                {
                                    "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                    "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "p4PostUserData",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Post Userdata",
                        "defaultValue": "",
                        "toolTip": "Userdata to run after the default P4 userdata.",
                        "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                        "multiLine": true,
                        "constraints": {
                            "required": false,
                            "validations": [
                                {
                                    "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                    "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "HansoftConfig",
                "label": "Hansoft Configuration",
                "subLabel": {
                    "preValidation": "Configure the Hansoft resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Hansoft Configuration",
                "elements": [
                    {
                        "name": "deployHansoft",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Hansoft",
                        "defaultValue": "true",
                        "toolTip": "Optionally select to deploy Hansoft",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "true",
                                    "value": "yes"
                                },
                                {
                                    "label": "false",
                                    "value": "no"
                                }
                            ],
                            "required": true
                        }
                    },
                    {
                        "name": "vmSettings",
                        "type": "Microsoft.Common.Section",
                        "label": "Hansoft VM Settings",
                        "elements": [
                            {
                                "name": "vmSize",
                                "type": "Microsoft.Compute.SizeSelector",
                                "label": "Hansoft instance type",
                                "toolTip": "Select Hansoft VM SKU",
                                "recommendedSizes": [
                                    "Standard_D2_v2",
                                    "Standard_D2_v4",
                                    "Standard_D4_v4",
                                    "Standard_D8_v4"
                                ],
                                "constraints": {
                                    "allowedSizes": [
                                        "Standard_D2s_v2",
                                        "Standard_D2s_v3",
                                        "Standard_D2as_v4",
                                        "Standard_D2d_v4",
                                        "Standard_D2_v4",
                                        "Standard_D4_v4",
                                        "Standard_D8_v4",
                                        "Standard_D4_v3",
                                        "Standard_D8_v3",
                                        "Standard_D4a_v4",
                                        "Standard_D8a_v4",
                                        "Standard_D4d_v4",
                                        "Standard_D8d_v4"
                                    ]
                                },
                                "osPlatform": "Linux",
                                "count": "1",
                                "visible": true
                            },
                            {
                                "name": "rootDiskSize",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Hansoft instance root disk size",
                                "defaultValue": "30",
                                "toolTip": "Provide the size of the Hansoft root disk - The size (GB) of the Managed disk.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^([3-9]\\d{1}\\d*|\\d{3}\\d*)$",
                                    "validationMessage": "Value must be numeric and greater than or equal to 30"
                                }
                            },
                            {
                                "name": "preUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Pre Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run before the default Hansoft userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "postUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Post Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run after the default Hansoft userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            }
                        ],
                        "visible": "[steps('HansoftConfig').deployHansoft]"
                    }
                ]
            },
            {
                "name": "SwarmConfig",
                "label": "Swarm Configuration",
                "subLabel": {
                    "preValidation": "Configure the Swarm resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Swarm Configuration",
                "elements": [
                    {
                        "name": "deploySwarm",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Swarm",
                        "defaultValue": "true",
                        "toolTip": "Optionally select to deploy Swarm",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "true",
                                    "value": "yes"
                                },
                                {
                                    "label": "false",
                                    "value": "no"
                                }
                            ],
                            "required": true
                        }
                    },
                    {
                        "name": "vmSettings",
                        "type": "Microsoft.Common.Section",
                        "label": "Swarm VM Settings",
                        "elements": [
                            {
                                "name": "vmSize",
                                "type": "Microsoft.Compute.SizeSelector",
                                "label": "Swarm instance type",
                                "toolTip": "Select Swarm VM SKU",
                                "recommendedSizes": [
                                    "Standard_D2_v2",
                                    "Standard_D2_v4",
                                    "Standard_D4_v4",
                                    "Standard_D8_v4"
                                ],
                                "constraints": {
                                    "allowedSizes": [
                                        "Standard_D2_v2",
                                        "Standard_D2_v3",
                                        "Standard_D2a_v4",
                                        "Standard_D2d_v4",
                                        "Standard_D2_v4",
                                        "Standard_D4_v4",
                                        "Standard_D8_v4",
                                        "Standard_D4_v3",
                                        "Standard_D8_v3",
                                        "Standard_D4a_v4",
                                        "Standard_D8a_v4",
                                        "Standard_D4d_v4",
                                        "Standard_D8d_v4"
                                    ]
                                },
                                "osPlatform": "Linux",
                                "count": "1",
                                "visible": true
                            },
                            {
                                "name": "rootDiskSize",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Swarm instance root disk size",
                                "defaultValue": "30",
                                "toolTip": "Provide the size of the Swarm root disk - The size (GB) of the Managed disk.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^([3-9]\\d{1}\\d*|\\d{3}\\d*)$",
                                    "validationMessage": "Value must be numeric and greater than or equal to 30"
                                }
                            },
                            {
                                "name": "preUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Pre Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run before the default Swarm userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "postUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Post Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run after the default Swarm userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            }
                        ],
                        "visible": "[steps('SwarmConfig').deploySwarm]"
                    }
                ]
            },
            {
                "name": "WorkstationConfig",
                "label": "Workstation Configuration",
                "subLabel": {
                    "preValidation": "Configure the Windows Workstation's resources and settings",
                    "postValidation": "Done"
                },
                "bladeTitle": "Windows Workstation Configuration",
                "elements": [
                    {
                        "name": "deployWorkstation",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Windows Workstation",
                        "defaultValue": "true",
                        "toolTip": "Optionally select to deploy the Windows Workstation",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "true",
                                    "value": "yes"
                                },
                                {
                                    "label": "false",
                                    "value": "no"
                                }
                            ]
                        }
                    },
                    {
                        "name": "vmSettings",
                        "type": "Microsoft.Common.Section",
                        "label": "Workstation VM Settings",
                        "elements": [
                            {
                                "name": "vmSize",
                                "type": "Microsoft.Compute.SizeSelector",
                                "label": "Windows instance type",
                                "toolTip": "Select Windows Workstation VM SKU",
                                "recommendedSizes": [
                                    "Standard_D1_v2",
                                    "Standard_NV4as_v4",
                                    "Standard_NV8as_v4",
                                    "Standard_NV16as_v4",
                                    "Standard_NV32as_v4"
                                ],
                                "constraints": {
                                    "allowedSizes": [
                                        "Standard_NV12s_v3",
                                        "Standard_NV24s_v3",
                                        "Standard_NV48s_v3",
                                        "Standard_NV4as_v4",
                                        "Standard_NV8as_v4",
                                        "Standard_NV16as_v4",
                                        "Standard_NV32as_v4",
                                        "Standard_D1_v2"
                                    ]
                                },
                                "osPlatform": "Windows",
                                "count": "1",
                                "visible": true
                            },
                            {
                                "name": "rootDiskSize",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Windows instance root disk size",
                                "defaultValue": "128",
                                "toolTip": "Provide the size of the root disk - The size (GB) of the Managed disk.",
                                "constraints": {
                                    "required": true,
                                    "regex": "^(12[8-9]|1[3-9][0-9]|[2-9][0-9]{2}|[1-9][0-9]{3,})$",
                                    "validationMessage": "Value must be numeric and greater than or equal to 128"
                                }
                            },
                            {
                                "name": "preUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Pre Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run before the default Workstation userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            },
                            {
                                "name": "postUserData",
                                "type": "Microsoft.Common.TextBox",
                                "label": "Post Userdata",
                                "defaultValue": "",
                                "toolTip": "Userdata to run after the default Workstation userdata.",
                                "placeholder": "This is a multi-line text box:\nLine 1.\nLine 2.\nLine 3.",
                                "multiLine": true,
                                "constraints": {
                                    "required": false,
                                    "validations": [
                                        {
                                            "regex": "^[a-z0-9A-Z -.:\n]{1,}$",
                                            "message": "Only alphanumeric characters, hyphens, spaces, periods, and colons are allowed."
                                        }
                                    ]
                                },
                                "visible": true
                            }
                        ],
                        "visible": "[steps('WorkstationConfig').deployWorkstation]"
                    }
                ]
            },
            {
                "name": "tags",
                "label": "Tags",
                "subLabel": {
                    "preValidation": "Configure the tags for resources",
                    "postValidation": "Done"
                },
                "bladeTitle": "Tags",
                "elements": [
                    {
                        "name": "tagsByResource",
                        "type": "Microsoft.Common.TagsByResource",
                        "resources": [
                            "Microsoft.Storage/storageAccounts",
                            "Microsoft.Compute/virtualMachines"
                        ]
                    }
                ]
            }
        ],
        "outputs": {
            "location": "[location()]",
            "environment": "[basics('environment')]",
            "primaryZone": "[parse(concat('\"',coalesce(basics('primaryZone'), ''),'\"'))]",
            "secondaryZone": "[parse(concat('\"',coalesce(basics('secondaryZone'), ''),'\"'))]",
            "vnetNewOrExisting": "[steps('VirtualNetworkConfig').virtualNetwork.newOrExisting]",
            "vnetName": "[steps('VirtualNetworkConfig').virtualNetwork.name]",
            "vnetAddressPrefixes": "[steps('VirtualNetworkConfig').virtualNetwork.addressPrefixes]",
            "publicSubnet0Name": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet1.name]",
            "publicSubnet0": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet1.addressPrefix]",
            "publicSubnet1Name": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet2.name]",
            "publicSubnet1": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet2.addressPrefix]",
            "privateSubnet0Name": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet3.name]",
            "privateSubnet0": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet3.addressPrefix]",
            "privateSubnet1Name": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet4.name]",
            "privateSubnet1": "[steps('VirtualNetworkConfig').virtualNetwork.subnets.subnet4.addressPrefix]",
            "vnetResourceGroupName": "[steps('VirtualNetworkConfig').virtualNetwork.resourceGroup]",
            "nsgIPRangeToPermit": "[steps('VirtualNetworkConfig').ipRangeToPermitFrom]",
            "p4AdminUser": "[steps('PerforceServerConfig').linuxCredential.adminUsername]",
            "p4VMSize": "[steps('PerforceServerConfig').p4VMSize]",
            "p4PrivateAddress": "[steps('PerforceServerConfig').p4PrivateAddress]",
            "p4SSHSource": "[steps('PerforceServerConfig').linuxCredential.p4SSHSource]",
            "p4AdminKeyID": "[steps('PerforceServerConfig').linuxCredential.adminExistKey.id]",
            "p4AdminAuthType": "[steps('PerforceServerConfig').linuxCredential.adminPublicKey.authenticationType]",
            "p4AdminPublicKey": "[steps('PerforceServerConfig').linuxCredential.adminPublicKey.sshPublicKey]",
            "p4FromScratchOrSnapshot": "[steps('PerforceServerConfig').p4FromScratchOrSnapshot]",
            "p4SnapshotIDArchive": "[steps('PerforceServerConfig').p4SnapshotIDArchive.id]",
            "p4SnapshotIDJournal": "[steps('PerforceServerConfig').p4SnapshotIDJournal.id]",
            "p4SnapshotIDLog": "[steps('PerforceServerConfig').p4SnapshotIDLog.id]",
            "p4SnapshotIDMetadata": "[steps('PerforceServerConfig').p4SnapshotIDMetadata.id]",
            "depotDiskType": "[steps('PerforceServerConfig').depotDiskType]",
            "depotDiskSize": "[int(steps('PerforceServerConfig').depotDiskSize)]",
            "logDiskType": "[steps('PerforceServerConfig').logDiskType]",
            "logDiskSize": "[int(steps('PerforceServerConfig').logDiskSize)]",
            "metadataDiskType": "[steps('PerforceServerConfig').metadataDiskType]",
            "metadataDiskSize": "[int(steps('PerforceServerConfig').metadataDiskSize)]",
            "journalDiskType": "[steps('PerforceServerConfig').journalDiskType]",
            "journalDiskSize": "[int(steps('PerforceServerConfig').journalDiskSize)]",
            "p4PreUserData": "[steps('PerforceServerConfig').p4PreUserData]",
            "p4PostUserData": "[steps('PerforceServerConfig').p4PostUserData]",
            "deployHansoft": "[steps('HansoftConfig').deployHansoft]",
            "hansoftVMSize": "[steps('HansoftConfig').vmSettings.vmSize]",
            "hansoftRootDiskSize": "[int(steps('HansoftConfig').vmSettings.rootDiskSize)]",
            "hansoftPreUserData": "[steps('HansoftConfig').vmSettings.preUserData]",
            "hansoftPostUserData": "[steps('HansoftConfig').vmSettings.postUserData]",
            "deploySwarm": "[steps('SwarmConfig').deploySwarm]",
            "swarmVMSize": "[steps('SwarmConfig').vmSettings.vmSize]",
            "swarmRootDiskSize": "[int(steps('SwarmConfig').vmSettings.rootDiskSize)]",
            "swarmPreUserData": "[steps('SwarmConfig').vmSettings.preUserData]",
            "swarmPostUserData": "[steps('SwarmConfig').vmSettings.postUserData]",
            "deployWorkstation": "[steps('WorkstationConfig').deployWorkstation]",
            "workstationVMSize": "[steps('WorkstationConfig').vmSettings.vmSize]",
            "workstationRootDiskSize": "[int(steps('WorkstationConfig').vmSettings.rootDiskSize)]",
            "workstationPreUserData": "[steps('WorkstationConfig').vmSettings.preUserData]",
            "workstationPostUserData": "[steps('WorkstationConfig').vmSettings.postUserData]",
            "tagsByResource": "[steps('tags').tagsByResource]"
        }
    }
}